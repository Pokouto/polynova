{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto py-10 px-4 sm:px-6 lg:px-8">
    <div class="md:flex md:items-center md:justify-between mb-8"><div class="flex-1"><h2 class="text-2xl font-bold text-gray-900">Mon Espace Parent</h2></div></div>
    <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
        <div class="lg:col-span-1 space-y-6">
            <div class="bg-white shadow rounded-lg border border-gray-100 p-5">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Actions Rapides</h3>
                <div class="space-y-3"><a href="{% url 'tutor_list' %}" class="block w-full text-center px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition"><i class="fas fa-search mr-2"></i> Chercher un prof</a><a href="{% url 'create_request' %}" class="block w-full text-center px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition shadow-sm"><i class="fas fa-plus mr-2"></i> Poster une annonce</a></div>
            </div>
            <div class="bg-blue-50 border border-blue-100 rounded-lg p-5"><div class="flex items-center"><div class="flex-shrink-0 bg-blue-200 rounded-full p-3 text-blue-600"><i class="fas fa-bullhorn text-xl"></i></div><div class="ml-4"><h4 class="text-lg font-bold text-blue-900">{{ my_requests.count }}</h4><p class="text-sm text-blue-700">Demandes publiées</p></div></div></div>
        </div>
        <div class="lg:col-span-2 space-y-8">
            <div id="profileSection" class="bg-white shadow sm:rounded-lg overflow-hidden border border-gray-200">
                <div class="px-6 py-5 border-b border-gray-200 flex justify-between items-center bg-gray-50"><h3 class="text-lg font-medium text-gray-900">Mes Informations</h3><button onclick="toggleEditMode()" id="editBtn" class="text-blue-600 hover:text-blue-800 text-sm font-bold"><i class="fas fa-pen mr-1"></i> Modifier</button><button onclick="toggleEditMode()" id="cancelBtn" class="hidden text-gray-500 hover:text-gray-700 text-sm">Annuler</button></div>
                <div id="viewMode" class="px-6 py-6"><dl class="grid grid-cols-1 gap-x-4 gap-y-6 sm:grid-cols-2"><div><dt class="text-sm font-medium text-gray-500">Nom complet</dt><dd class="mt-1 text-sm text-gray-900 font-semibold">{{ user.first_name }} {{ user.last_name }}</dd></div><div><dt class="text-sm font-medium text-gray-500">Email</dt><dd class="mt-1 text-sm text-gray-900">{{ user.email }}</dd></div><div><dt class="text-sm font-medium text-gray-500">Téléphone</dt><dd class="mt-1 text-sm text-gray-900">{{ user.phone|default:"Non renseigné" }}</dd></div><div><dt class="text-sm font-medium text-gray-500">Adresse / Quartier</dt><dd class="mt-1 text-sm text-gray-900">{{ profile.address|default:"Non renseignée" }}</dd></div></dl></div>
                <div id="editMode" class="hidden px-6 py-6 bg-gray-50"><form method="POST" class="space-y-6">{% csrf_token %}<div class="grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-2"><div><label class="block text-sm font-medium text-gray-700">Nom</label>{{ u_form.last_name }}</div><div><label class="block text-sm font-medium text-gray-700">Prénom</label>{{ u_form.first_name }}</div><div><label class="block text-sm font-medium text-gray-700">Email</label>{{ u_form.email }}</div><div><label class="block text-sm font-medium text-gray-700">Téléphone</label>{{ u_form.phone }}</div></div><div><label class="block text-sm font-medium text-gray-700">Adresse / Quartier</label>{{ p_form.address }}</div><div class="pt-4 border-t border-gray-200 flex justify-end"><button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 shadow-sm transition">Enregistrer</button></div></form></div>
            </div>
            <div>
                <h3 class="text-xl font-bold text-gray-900 mb-4">Mes demandes de cours</h3>
                <div class="bg-white shadow overflow-hidden sm:rounded-lg border border-gray-200">
                    {% if my_requests %}<ul class="divide-y divide-gray-200">{% for req in my_requests %}<li class="hover:bg-gray-50 transition duration-150"><div class="px-6 py-5"><div class="flex items-center justify-between mb-2"><div class="text-sm font-bold text-blue-600 truncate flex items-center"><span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded mr-2 uppercase tracking-wide">{{ req.level.name }}</span>{% for sub in req.subjects.all %}{{ sub.name }}{% if not forloop.last %}, {% endif %}{% endfor %}</div><span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full {% if req.status == 'active' %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">{% if req.status == 'active' %}En cours{% else %}Expirée{% endif %}</span></div><div class="flex justify-between items-end"><div class="text-sm text-gray-500"><p class="flex items-center mt-1"><i class="fas fa-map-marker-alt mr-2 text-gray-400 w-4"></i> {{ req.city.name }}</p><p class="flex items-center mt-1"><i class="fas fa-wallet mr-2 text-gray-400 w-4"></i> {{ req.get_budget_range_display }}</p><p class="flex items-center mt-1 text-xs text-gray-400"><i class="far fa-calendar-alt mr-2 w-4"></i> Publiée le {{ req.created_at|date:"d F Y" }}</p></div><a href="{% url 'edit_request' req.id %}" class="text-blue-600 hover:text-blue-800 text-xs font-bold flex items-center border border-blue-200 px-2 py-1 rounded bg-blue-50 hover:bg-blue-100 transition"><i class="fas fa-pencil-alt mr-1"></i> Modifier</a></div></div></li>{% endfor %}</ul>{% else %}<div class="text-center py-12"><h3 class="text-lg font-medium text-gray-900">Aucune demande</h3><a href="{% url 'create_request' %}" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700"><i class="fas fa-plus mr-2"></i> Poster ma première annonce</a></div>{% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
<script>function toggleEditMode() { const view = document.getElementById('viewMode'); const edit = document.getElementById('editMode'); const editBtn = document.getElementById('editBtn'); const cancelBtn = document.getElementById('cancelBtn'); if (edit.classList.contains('hidden')) { view.classList.add('hidden'); edit.classList.remove('hidden'); editBtn.classList.add('hidden'); cancelBtn.classList.remove('hidden'); } else { view.classList.remove('hidden'); edit.classList.add('hidden'); editBtn.classList.remove('hidden'); cancelBtn.classList.add('hidden'); } }</script>
{% endblock %}